name: Build and Deploy

on:
  push:
    branches:
      - '**'
      - '!main'

run-name: "Branch name: ${{ github.ref_name }}, Environment name: ${{ github.short_sha }} run by @${{ github.actor }}"

jobs:
  build:
    name: "Branch: ${{ github.ref_name }}, Env: ${{ github.event.inputs.env_name }}"
    permissions:
      contents: 'read'
      id-token: 'write'

    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ env.GITHUB_REF }}

      - name: Setting build environment
        run: |
            echo "TAG=${GITHUB_SHA::7}" >> $GITHUB_ENV

      - name: List Env Variables
        run: |
          env
          cat $GITHUB_ENV

      - name: Print some variables
        run: |
          echo ${{ env.TAG }}
          echo ${{ github.sha }}
          cat $GITHUB_ENV

